# Custom Sysdig Chisel for ReplicaWatcher

This repository contains a set of Lua scripts that extend Sysdig functionality to capture and analyze kernel events generated by replicas of a microservice. The scripts are designed to be used with Sysdig, a powerful open-source tool for container and system troubleshooting, exploration, and analysis.

## Prerequisites

- Sysdig installed on your system. 

## Scripts Overview

1. **cutils.lua**: Contains auxiliary utility functions.
2. **extract.lua**: Transforms kernel events into unique feature sets.
3. **fields.lua**: Defines key mappings for various fields used in event data collection, such as pod names and system calls.
4. **parse.lua**: Implements `PodDataHandler` to parse event data and generate structured information for each pod.
5. **replicawatcher.lua**: The main chisel script used to capture and process events from pod (replica) belonging to a deployment.
   

## Installation

1. Clone or download this repository to your local machine.
2. Copy the scripts to the Sysdig chisel directory, typically located at `/usr/share/sysdig/chisel`:

    ```bash
    sudo cp chisel/* /usr/share/sysdig/chisels
    ```

## Usage

To capture events from the replicas of a specific microservice, use the `replicawatcher` script with Sysdig. You will need to pass the name of the deployment, the name of the output file, and the duration for capturing events in seconds.

```bash
sudo sysdig --k8s-api <server-address> -c replicawatcher "deploymentName outputfile.json" -M duration_in_seconds
```
